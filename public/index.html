<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>GitHub → Netlify Auto Deploy</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --primary:#14b8a6;
  --primary-dark:#0f766e;
  --bg:#f4f5f7;
  --card:#ffffff;
  --text:#0f172a;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.card{
  width:100%;
  max-width:420px;
  background:var(--card);
  border-radius:18px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.08);
}

h1{
  font-size:20px;
  text-align:center;
  margin-bottom:20px;
  color:var(--text);
}

button, select, input{
  width:100%;
  padding:12px 14px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #e5e7eb;
  font-size:14px;
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
  font-weight:600;
}

button:disabled{
  background:#94a3b8;
}

button.secondary{
  background:#bbf7d0;
  color:#065f46;
}

input[readonly]{
  background:#f8fafc;
}

#error{
  display:none;
  margin-top:12px;
  padding:10px;
  background:#fee2e2;
  color:#7f1d1d;
  border-radius:10px;
  font-size:13px;
  white-space:pre-wrap;
}

footer{
  text-align:center;
  margin-top:18px;
  font-size:12px;
  color:#64748b;
}
</style>
</head>

<body>

<div class="card">
  <h1>TOOLS AUTO GENERATE</h1>

  <button id="loadBtn" onclick="loadRepos()">Ambil Repository</button>

  <select id="repoSelect">
    <option value="">— Pilih repository —</option>
  </select>

  <button id="deployBtn" onclick="deploy()">GENERATE</button>

  <div id="error"></div>

  <input id="result" readonly placeholder="URL hasil deploy">
  <button class="secondary" onclick="copy()">Copy</button>

  <footer>tools by sesepuh © 2026</footer>
</div>

<script>
const loadBtn = document.getElementById('loadBtn');
const deployBtn = document.getElementById('deployBtn');
const errorBox = document.getElementById('error');
const result = document.getElementById('result');

function setLoading(btn, text){
  btn.disabled = true;
  btn.dataset.old = btn.textContent;
  btn.textContent = text;
}

function clearLoading(btn){
  btn.disabled = false;
  btn.textContent = btn.dataset.old;
}

function showError(msg){
  errorBox.style.display='block';
  errorBox.textContent=msg;
}

function clearError(){
  errorBox.style.display='none';
  errorBox.textContent='';
}

async function loadRepos(){
  clearError();
  setLoading(loadBtn,'Memuat...');
  const r = await fetch('/api/github');
  const data = await r.json();
  const s = document.getElementById('repoSelect');

  s.innerHTML='<option value="">— Pilih repository —</option>';
  data.forEach(x=>{
    const o=document.createElement('option');
    o.value=x.full_name;
    o.textContent=x.full_name;
    s.appendChild(o);
  });
  clearLoading(loadBtn);
}

async function deploy(){
  clearError();
  result.value='';
  const repo = repoSelect.value;

  if(!repo){
    showError('Repository belum dipilih');
    return;
  }

  setLoading(deployBtn,'Memuat...');

  const r = await fetch('/api/deploy-netlify',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({repoFullName:repo})
  });

  const d = await r.json();

  clearLoading(deployBtn);

  if(!d.url){
    showError(JSON.stringify(d,null,2));
    return;
  }

  result.value=d.url;
}

function copy(){
  if(!result.value){
    showError('Belum ada link');
    return;
  }
  navigator.clipboard.writeText(result.value);
  alert('Link disalin');
}
</script>

</body>
</html>
